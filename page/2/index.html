<!DOCTYPE html>




<html class="theme-next gemini" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="HaFr6IFRWpWkG_Eyt4dUUQlgTyTE85bMpbJKQQgp0Rw" />














  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="独立游戏开发者">
<meta property="og:type" content="website">
<meta property="og:title" content="隔壁老王">
<meta property="og:url" content="http://www.oldking.wang/page/2/index.html">
<meta property="og:site_name" content="隔壁老王">
<meta property="og:description" content="独立游戏开发者">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="隔壁老王">
<meta name="twitter:description" content="独立游戏开发者">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.3',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.oldking.wang/page/2/"/>





  <title>隔壁老王 - 独立游戏开发者</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-111727312-1', 'auto');
  ga('send', 'pageview');
</script>





</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">隔壁老王</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">独立游戏开发者</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-unity">
          <a href="/categories/Unity" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-diamond"></i> <br />
            
            Unity
          </a>
        </li>
      
        
        <li class="menu-item menu-item-编程">
          <a href="/categories/编程" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-graduation-cap"></i> <br />
            
            编程
          </a>
        </li>
      
        
        <li class="menu-item menu-item-其他">
          <a href="/categories/其他" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-beer"></i> <br />
            
            其他
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.oldking.wang/7e6e8520-9327-11e8-8570-f1a9668fbbb1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="隔壁老王">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="隔壁老王">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/7e6e8520-9327-11e8-8570-f1a9668fbbb1/" itemprop="url">Unity使用UGUI的Image在Canvas中画直线</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-29T20:04:06+08:00">
                2018-07-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Unity/" itemprop="url" rel="index">
                    <span itemprop="name">Unity</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><p><img src="https://media.giphy.com/media/2uI8VGFdAOys8WQlXR/giphy.gif" alt=""></p>
<h2 id="核心代码"><a href="#核心代码" class="headerlink" title="核心代码"></a>核心代码</h2><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestDrawLine</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> Image arrow; <span class="comment">//Image 素材</span></span><br><span class="line">    <span class="keyword">public</span> RectTransform pa; <span class="comment">//A点</span></span><br><span class="line">    <span class="keyword">public</span> RectTransform pb; <span class="comment">//B点</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> rP = pa.rectTransform().anchoredPosition;</span><br><span class="line">        <span class="keyword">var</span> tp = pa.position;</span><br><span class="line">        Debug.Log(<span class="string">$"A点  Transform P:(<span class="subst">&#123;tp.x&#125;</span>,<span class="subst">&#123;tp.y&#125;</span>) RectTransform P :(<span class="subst">&#123;rP.x&#125;</span>,<span class="subst">&#123;rP.y&#125;</span>)"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        arrow.transform.position = pa.position;</span><br><span class="line">        arrow.transform.localRotation = Quaternion.AngleAxis(-GetAngle(), Vector3.forward);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> distance = Vector2.Distance(pb.anchoredPosition, pa.anchoredPosition);</span><br><span class="line">        arrow.rectTransform.sizeDelta = <span class="keyword">new</span> Vector2(<span class="number">10</span>, Math.Max(<span class="number">1</span>, distance - <span class="number">30</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">GetAngle</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> dir = pb.position - pa.position;</span><br><span class="line">        <span class="keyword">var</span> dirV2 = <span class="keyword">new</span> Vector2(dir.x, dir.y);</span><br><span class="line">        <span class="keyword">var</span> angle = Vector2.SignedAngle(dirV2, Vector2.down);</span><br><span class="line">        <span class="keyword">return</span> angle;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="相关知识点"><a href="#相关知识点" class="headerlink" title="相关知识点"></a>相关知识点</h2><p>恩,代码没几行 但是涉及到的知识点还挺多. 感觉可以当 <code>Unity面试题</code> 来用啊 哈哈.</p>
<h3 id="取得两个坐标点之间的夹角"><a href="#取得两个坐标点之间的夹角" class="headerlink" title="取得两个坐标点之间的夹角"></a>取得两个坐标点之间的夹角</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Vector2</span><span class="selector-class">.SignedAngle</span>(<span class="selector-tag">dirV2</span>, <span class="selector-tag">Vector2</span><span class="selector-class">.down</span>)</span><br></pre></td></tr></table></figure>
<p>这个我之前有写过,详情参见 <a href="http://oldking.wang/479077a0-7bb4-11e8-a311-29f834f4679d/" target="_blank" rel="noopener">求两向量在0~360度之间的角度值及实际应用</a></p>
<h3 id="取得Canvas中元素的x-y坐标"><a href="#取得Canvas中元素的x-y坐标" class="headerlink" title="取得Canvas中元素的x,y坐标"></a>取得Canvas中元素的x,y坐标</h3><p>我在<code>Start</code>函数有输出,元素的<code>Transform.position</code>和<code>RectTransform.position</code>(实际应用时候应该取锚点)是有区别的</p>
<p>输出Log为:</p>
<blockquote>
<p>A点  Transform P:(98.82188,194.5938) RectTransform P :(-391,130)</p>
</blockquote>
<h3 id="取得Canvas中两元素的距离"><a href="#取得Canvas中两元素的距离" class="headerlink" title="取得Canvas中两元素的距离"></a>取得Canvas中两元素的距离</h3><p>这个主要是要注意使用<code>anchoredPosition</code>,也就是<code>RectTransform</code>坐标系下的点坐标.使用<code>Transform</code>坐标系下的算出距离是错误的.</p>
<p>直接<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Vector2.Distance($A点<span class="number">2</span>D坐标,$B点<span class="number">2</span>D坐标)</span><br></pre></td></tr></table></figure></p>
<h3 id="设置UGUI中Image的宽高"><a href="#设置UGUI中Image的宽高" class="headerlink" title="设置UGUI中Image的宽高"></a>设置UGUI中Image的宽高</h3><p>使用<a href="https://docs.unity3d.com/ScriptReference/RectTransform-sizeDelta.html" target="_blank" rel="noopener"><code>sizeDelta</code></a>函数</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arrow.rectTransform.sizeDelta = new Vector2(<span class="variable">$宽</span>,<span class="variable">$高</span>);</span><br></pre></td></tr></table></figure>
<h3 id="元素绕任意轴旋转"><a href="#元素绕任意轴旋转" class="headerlink" title="元素绕任意轴旋转"></a>元素绕任意轴旋转</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arrow<span class="selector-class">.transform</span><span class="selector-class">.localRotation</span> = Quaternion.AngleAxis($旋转角度,$旋转轴)</span><br></pre></td></tr></table></figure>
<p>恩.. 四元数旋转 好像也没啥好说的 :(</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.oldking.wang/b24893f0-8f1b-11e8-8b0f-41ccb1e92c0b/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="隔壁老王">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="隔壁老王">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/b24893f0-8f1b-11e8-8b0f-41ccb1e92c0b/" itemprop="url">在Unity中使用工具生成GameObject节点的FullPath</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-24T16:29:35+08:00">
                2018-07-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Unity/" itemprop="url" rel="index">
                    <span itemprop="name">Unity</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="最终效果"><a href="#最终效果" class="headerlink" title="最终效果"></a>最终效果</h2><ul>
<li>GameObject上面右键生成配置信息</li>
</ul>
<p><img src="https://media.giphy.com/media/ADTfkkmN4ClmAUmuK1/giphy.gif" alt="ImgGIF"></p>
<ul>
<li>生成CS文件</li>
</ul>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">Code.AutoGenerate</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GUIPath</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Demo</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">string</span> NameTF = <span class="string">"a0"</span>;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">string</span> InfoBox = <span class="string">"a1"</span>;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">string</span> Info01 = <span class="string">"a2"</span>;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">string</span> InfoBox_Info01_MsgTF = <span class="string">"a3"</span>;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">string</span> InfoBox_Info01_Icon = <span class="string">"a4"</span>;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">string</span> InfoBox_Info02 = <span class="string">"a5"</span>;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">string</span> InfoBox_Info02_MsgTF = <span class="string">"a6"</span>;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">string</span> InfoBox_Info03_MsgTF = <span class="string">"a7"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>运行时候通过生成的文件查找对应节点的FullPath</li>
</ul>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Test01</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> go = transform.Find(GameGUI.FullPath(GUIPath.Demo.InfoBox_Info01_Icon));</span><br><span class="line">        <span class="keyword">var</span> img = go.GetComponent&lt;Image&gt;();</span><br><span class="line">        img.color = Color.green;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>对于在项目中是否使用 public 属性然后在Inspector中进行赋值 的方式进行 GUI界面的制作.一直存在两个声音. 有人支持,有人反对. </p>
<p>各有各的道理吧,因为各自项目不同 所以也不好一概而论.</p>
<h3 id="Private-赋值方式的优点"><a href="#Private-赋值方式的优点" class="headerlink" title="Private 赋值方式的优点"></a>Private 赋值方式的优点</h3><p>就我个人而言,目前来说 我还是比较倾向于用 private 声明然后再通过<code>transform.Find()</code>方式赋值的方法.</p>
<p>我认为这种方法有几个优点</p>
<ul>
<li><p>对混淆友好: 以Inspector进行拖拽赋值的方法 肯定是无法混淆的</p>
</li>
<li><p>抗灾能力强: 尤其是对于研发周期在半年以上的中大型项目,且是多人同时提交代码. 当出现一两次<code>Missing Reference</code>的事故时候,你会更加深入理解这个问题的:)</p>
</li>
<li><p>易于模块化开发: 对于复杂的面板,我一般会拆分多个组件,然后主GUI上挂载Manger类进行其内部组件的协调. 如果采用public赋值方法,所有组件的变量都需要在Manger类内部进行引用切赋值.导致这个类内部很乱.并且所有子组件都需要和Manger进行交叉引用.增大了组件之间的耦合度.</p>
</li>
</ul>
<h3 id="Private-赋值方式的缺点"><a href="#Private-赋值方式的缺点" class="headerlink" title="Private 赋值方式的缺点"></a>Private 赋值方式的缺点</h3><p>缺点就我现在的体会来说 就是觉得<strong>赋值很麻烦</strong>.</p>
<p><img src="/media/Jietu20180724-170141.jpg" alt="Jietu20180724-170141"></p>
<p>比如像上面这段,编写期间要不停的Unity和Rider之间切换然后Copy字符串. 并且如果出现结构上的重构时候.也很麻烦.</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>我还是按照之前处理<a href="http://oldking.wang/70851a90-8c25-11e8-9c42-b1751b7abeea/" target="_blank" rel="noopener">在Unity项目中隐藏StringConst</a>方式一样.</p>
<p>写GUI工具,同时生成一份CS文件和一个二进制文件.</p>
<p>然后代码中直接通过CS文件中定义的Key去找二进制文件所放置的FullPath即可</p>
<h2 id="核心代码"><a href="#核心代码" class="headerlink" title="核心代码"></a>核心代码</h2><h3 id="将工具入口放置在右键菜单中"><a href="#将工具入口放置在右键菜单中" class="headerlink" title="将工具入口放置在右键菜单中"></a>将工具入口放置在右键菜单中</h3><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="name">MenuItem</span>(<span class="string">"GameObject/UI/$&#123;你自定义的子目录&#125;"</span>)]</span><br></pre></td></tr></table></figure>
<p>详情参考<a href="https://unity3d.com/cn/learn/tutorials/topics/interface-essentials/unity-editor-extensions-menu-items" target="_blank" rel="noopener">Unity Editor Extensions – Menu Items</a></p>
<h3 id="使用内部类模板"><a href="#使用内部类模板" class="headerlink" title="使用内部类模板"></a>使用内部类模板</h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">Code.AutoGenerate</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GUIPath</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Demo</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">string</span> NameTF = <span class="string">"a0"</span>;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">string</span> InfoBox = <span class="string">"a1"</span>;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">string</span> Info01 = <span class="string">"a2"</span>;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">string</span> InfoBox_Info01_MsgTF = <span class="string">"a3"</span>;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">string</span> InfoBox_Info01_Icon = <span class="string">"a4"</span>;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">string</span> InfoBox_Info02 = <span class="string">"a5"</span>;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">string</span> InfoBox_Info02_MsgTF = <span class="string">"a6"</span>;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">string</span> InfoBox_Info03_MsgTF = <span class="string">"a7"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Demo_2</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">string</span> NameTF = <span class="string">"a8"</span>;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">string</span> InfoBox = <span class="string">"a9"</span>;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">string</span> Info01 = <span class="string">"a10"</span>;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">string</span> InfoBox_Info01_MsgTF = <span class="string">"a11"</span>;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">string</span> InfoBox_Info01_Icon = <span class="string">"a12"</span>;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">string</span> InfoBox_Info02 = <span class="string">"a13"</span>;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">string</span> InfoBox_Info02_MsgTF = <span class="string">"a14"</span>;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">string</span> InfoBox_Info03_MsgTF = <span class="string">"a15"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以需要构建的GameObject的Name作为内部类的类名去构建自动生成的CS文件. 这样在代码中会更加清晰.</p>
<p><img src="/media/Jietu20180724-185801.jpg" alt="Jietu20180724-185801"></p>
<h3 id="使用名称约束"><a href="#使用名称约束" class="headerlink" title="使用名称约束"></a>使用名称约束</h3><p><img src="/media/Jietu20180724-190052.jpg" alt="Jietu20180724-190052"></p>
<ul>
<li><p>以<code>S_</code>开头的节点会生成短名称,比如上图的<code>InfoBox</code></p>
</li>
<li><p>以<code>F_</code>开头的节点会生成长名称(用以区分同名节点).比如上图的<code>InfoBox_Info01_MsgTF</code></p>
</li>
<li><p>不以<code>S_</code>和<code>F_</code>开头的节点则不导出.(代码中不会直接操作该节点)</p>
</li>
</ul>
<h3 id="遍历一个GameObject取得其FullPath"><a href="#遍历一个GameObject取得其FullPath" class="headerlink" title="遍历一个GameObject取得其FullPath"></a>遍历一个GameObject取得其FullPath</h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> GUIFullPathNode <span class="title">GetNewNode</span>(<span class="params">GameObject _go</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> rootNode = <span class="keyword">new</span> GUIFullPathNode();</span><br><span class="line">    rootNode.nodeList = <span class="keyword">new</span> List&lt;GUIFullPathGameObjectWrap&gt;();</span><br><span class="line">    LoopCreateFullPath(_go.transform, _go.transform, rootNode);</span><br><span class="line">    <span class="keyword">return</span> rootNode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">LoopCreateFullPath</span>(<span class="params">Transform _currentTrans, Transform _rootTrans, GUIFullPathNode _rootNode</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> nodeName = _currentTrans.name;</span><br><span class="line">    <span class="keyword">if</span> (nodeName.StartsWith(SHORT_NAME_PR) || nodeName.StartsWith(FULL_NAME_PR))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> path = AnimationUtility.CalculateTransformPath(_currentTrans, _rootTrans);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">string</span>.IsNullOrEmpty(path))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> goWarp = <span class="keyword">new</span> GUIFullPathGameObjectWrap();</span><br><span class="line">            goWarp.fullPath = path;</span><br><span class="line">            goWarp.realKey = GetFullPathNodeRealName(path, _currentTrans.name);</span><br><span class="line">            _rootNode.nodeList.Add(goWarp);</span><br><span class="line">            Debug.Log(<span class="string">$"Go <span class="subst">&#123;_currentTrans.name&#125;</span>  ==&gt;&gt;  RealName: <span class="subst">&#123;goWarp.realKey&#125;</span> Path: <span class="subst">&#123;goWarp.fullPath&#125;</span>  "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> childNum = _currentTrans.childCount;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; childNum; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        LoopCreateFullPath(_currentTrans.GetChild(i), _rootTrans, _rootNode);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">string</span> <span class="title">GetFullPathNodeRealName</span>(<span class="params"><span class="keyword">string</span> _path, <span class="keyword">string</span> _nodeName</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> splitStringList = _path.Split(<span class="string">'/'</span>);</span><br><span class="line">    <span class="keyword">if</span> (_nodeName.StartsWith(SHORT_NAME_PR))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> DoGetRealName(splitStringList[splitStringList.Length - <span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> realName = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; splitStringList.Length; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        realName += DoGetRealName(splitStringList[i]) + <span class="string">"_"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//去掉尾部的"_"</span></span><br><span class="line">    <span class="keyword">return</span> realName.Substring(<span class="number">0</span>, realName.Length - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">string</span> <span class="title">DoGetRealName</span>(<span class="params"><span class="keyword">string</span> _name</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (_name.StartsWith(SHORT_NAME_PR) || _name.StartsWith(FULL_NAME_PR))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> _name.Substring(<span class="number">2</span>, _name.Length - <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> _name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这部分代码同时也包括了对<code>S_</code>和<code>F_</code>开头节点的解析. 其核心的遍历逻辑是调用</p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AnimationUtility.CalculateTransformPath(<span class="variable">_currentTrans</span>, <span class="variable">_rootTrans</span>);</span><br></pre></td></tr></table></figure>
<p>注意该函数仅可以在编辑器模式下调用.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.oldking.wang/70851a90-8c25-11e8-9c42-b1751b7abeea/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="隔壁老王">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="隔壁老王">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/70851a90-8c25-11e8-9c42-b1751b7abeea/" itemprop="url">在Unity项目中隐藏StringConst</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-20T22:01:46+08:00">
                2018-07-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Unity/" itemprop="url" rel="index">
                    <span itemprop="name">Unity</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="最终效果"><a href="#最终效果" class="headerlink" title="最终效果"></a>最终效果</h2><ul>
<li><p>在GUI界面中编辑StringConst<br><img src="https://media.giphy.com/media/5kFcdKkc2Q58nMrzDa/giphy.gif" alt="ImgGIF"></p>
</li>
<li><p>自动生成<code>StringConst.cs</code>文件</p>
</li>
</ul>
<p><img src="/media/Jietu20180720-220109.jpg" alt="Jietu20180720-220109"></p>
<ul>
<li>封装<code>GlobalConst</code>上层逻辑直接当做普通String字符串处理</li>
</ul>
<p><img src="/media/Jietu20180720-231320.jpg" alt="Jietu20180720-231320"></p>
<h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><p>目前, 就我所知的Unity反编译. 如果采用静态破解IL2CPP项目 切入点一般都从关键字入手.</p>
<p>比如搜索 <code>money</code>,<code>exp</code>,<code>attack</code>等等.</p>
<p>我主要是采用混淆代码的方式应对这种Hack. 但是混淆代码并不能对 <code>const string</code>进行混淆.</p>
<p>比如</p>
<p><img src="/media/Jietu20180720-220922.jpg" alt="Jietu20180720-220922"></p>
<p>这是我之前的老项目. 可以看到虽然 变量名全部混淆了. 但是其引用的字符串仍旧是明文的. 并且暴露出许多敏感信息.</p>
<p>所以 目前想出来这种方案.就是为了解决这个问题的.</p>
<h2 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h2><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><ul>
<li><p>(编辑阶段)通过GUI进行编辑相关的常量信息</p>
</li>
<li><p>(编辑阶段)生成一个cs文件,和一个加密后的二进制文件.</p>
</li>
<li><p>(运行阶段)将二进制文件解析为Key-Value字典.其中Key为混淆后的Key,Value为真实Value</p>
</li>
<li><p>(运行阶段)用生成的cs文件.对Key-Value字典进行访问.从而得到真实的常量值</p>
</li>
</ul>
<h3 id="核心代码"><a href="#核心代码" class="headerlink" title="核心代码"></a>核心代码</h3><p>具体实现,每个人会有自己的不同.这里全贴出来没有什么意义. 只列一些我认为比较核心的代码</p>
<h4 id="GUI部分"><a href="#GUI部分" class="headerlink" title="GUI部分"></a>GUI部分</h4><p>GUI用的是<code>OdinInspector</code>插件(推荐)</p>
<p><strong>发起弹窗</strong></p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[MenuItem(<span class="string">"常量表"</span>)]</span><br><span class="line">private<span class="keyword"> static</span> void OpenStringConstWinodw()</span><br><span class="line">&#123;</span><br><span class="line">    var<span class="built_in"> instance </span>=<span class="built_in"> new </span>GlobalStringEditWindow();</span><br><span class="line">    var window = OdinEditorWindow.InspectObject(instance);</span><br><span class="line">    window.position = GUIHelper.GetEditorWindowRect().AlignCenter(500, 700);</span><br><span class="line">    instance.OnShow(window);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>弹出部分</strong></p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GlobalStringEditWindow</span></span><br><span class="line">&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> OdinEditorWindow mSelfWindow;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;StringConstWrap&gt; stringConstList;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnShow</span>(<span class="params">OdinEditorWindow _window</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        mSelfWindow = _window;</span><br><span class="line">        </span><br><span class="line">        ...</span><br><span class="line">        ** 此处省略从二进制文件解密出来,然后复写到stringConstList部分代码</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    [<span class="meta">Button(<span class="meta-string">"保存并退出"</span>, ButtonSizes.Medium), GUIColor(0, 1, 0)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SaveAndClose</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> CSharpFileCreater = <span class="keyword">new</span> ObfuscatorIDMappingHelper();</span><br><span class="line"></span><br><span class="line">        stringConstList.ForEach(warp =&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> meta = <span class="keyword">new</span> ObfusKeyValueMeta();</span><br><span class="line">            meta.comment = warp.comment;</span><br><span class="line">            meta.realKey = warp.key;</span><br><span class="line">            meta.<span class="keyword">value</span> = warp.<span class="keyword">value</span>;</span><br><span class="line">            meta.classPropertyName = meta.realKey;</span><br><span class="line">            CSharpFileCreater.AddObfuscatorRes(meta);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//生成CS文件和*.byte文件</span></span><br><span class="line">        CSharpFileCreater.GenerateFile(<span class="string">"StringConst"</span>);</span><br><span class="line"></span><br><span class="line">        Debug.Log(<span class="string">"StringConst 保存成功"</span>);</span><br><span class="line"></span><br><span class="line">        mSelfWindow.Close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    [<span class="meta">Serializable</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">struct</span> StringConstWrap</span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="meta">FoldoutGroup(<span class="meta-string">"$Name"</span>, false)</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">string</span> comment;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">FoldoutGroup(<span class="meta-string">"$Name"</span>, false)</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">string</span> key;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">FoldoutGroup(<span class="meta-string">"$Name"</span>, false)</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">string</span> <span class="keyword">value</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">string</span> Name =&gt; comment ?? <span class="string">"Empty"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="代码生成"><a href="#代码生成" class="headerlink" title="代码生成"></a>代码生成</h4><p>代码生成部分,就是对应的我<code>CSharpFileCreater</code>部分的内容.</p>
<p>如果想使用模板类生成CS代码,可以参考以下几个Link</p>
<p><a href="http://www.li0rtal.com/code-generation-fun-with-unity/" target="_blank" rel="noopener">http://www.li0rtal.com/code-generation-fun-with-unity/</a></p>
<p><a href="https://github.com/Mtihc/Generate-Code-For-Unity" target="_blank" rel="noopener">https://github.com/Mtihc/Generate-Code-For-Unity</a></p>
<p><a href="https://www.gamasutra.com/blogs/ByronMayne/20160121/258356/Code_Generation_in_Unity.php" target="_blank" rel="noopener">https://www.gamasutra.com/blogs/ByronMayne/20160121/258356/Code_Generation_in_Unity.php</a></p>
<p><a href="https://forum.unity.com/threads/code-generation-with-unity.233661/" target="_blank" rel="noopener">https://forum.unity.com/threads/code-generation-with-unity.233661/</a></p>
<p>不过我需要生成的代码部分很简单,所以反而直接生写会简单一些.</p>
<p>代码如下:</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">private <span class="type">string</span> GetFileString(<span class="type">string</span> _className)</span><br><span class="line">&#123;</span><br><span class="line">    var fileString = <span class="string">""</span>;</span><br><span class="line">    fileString += <span class="string">"namespace Code.AutoGenerate<span class="subst">\n</span>"</span>;</span><br><span class="line">    fileString += <span class="string">"&#123;<span class="subst">\n</span>"</span>;</span><br><span class="line">    fileString += <span class="string">"    public class "</span> + _className + <span class="string">"<span class="subst">\n</span>"</span>;</span><br><span class="line">    fileString += <span class="string">"    &#123;<span class="subst">\n</span>"</span>;</span><br><span class="line"></span><br><span class="line">    mObfuscatorResList.ForEach(meta =&gt; &#123; fileString += $<span class="string">"        public const string &#123;meta.classPropertyName&#125; = <span class="subst">\"</span>&#123;meta.obfusKey&#125;<span class="subst">\"</span>;<span class="subst">\n</span>"</span>; &#125;);</span><br><span class="line"></span><br><span class="line">    fileString += <span class="string">"    &#125;<span class="subst">\n</span>"</span>;</span><br><span class="line">    fileString += <span class="string">"&#125;<span class="subst">\n</span>"</span>;</span><br><span class="line"></span><br><span class="line">    return fileString;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后将文本直接写入文件,直接用封装好的<code>File.WriteAllText(path, fileString);</code>方法即可.</p>
<h4 id="二进制加密"><a href="#二进制加密" class="headerlink" title="二进制加密"></a>二进制加密</h4><p>这部分我是将相应类首先序列化为Json,然后对Json文件进行ASE加密.再以二进制的方式存入本地</p>
<p><strong>注意</strong></p>
<blockquote>
<p>不要采用Unity内置的Json,或者说 所有需要使用到<code>[Serializable]</code>标签的序列化方案. 因为设置了这个标签就意味着 变量名 是无法改变的,(应该是反序列化时候都需要反射找到对应的属性?).</p>
</blockquote>
<p>变量名无法改变 也就是 无法混淆. 那之前做的一切就相当于白费了 :)</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.oldking.wang/479077a0-7bb4-11e8-a311-29f834f4679d/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="隔壁老王">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="隔壁老王">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/479077a0-7bb4-11e8-a311-29f834f4679d/" itemprop="url">求两向量在0~360度之间的角度值及实际应用</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-29T23:51:25+08:00">
                2018-06-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Unity/" itemprop="url" rel="index">
                    <span itemprop="name">Unity</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="实际应用"><a href="#实际应用" class="headerlink" title="实际应用"></a>实际应用</h2><p><img src="https://media.giphy.com/media/5PhYFv3LPBB9fkvaic/giphy.gif" alt="QQ20180629-235018-HD"></p>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>先从实际问题出发,这样可以更好的理解问题.</p>
<p>项目需要控制角色在地图中随意移动,角色素材是8方向的. 那问题就是</p>
<blockquote>
<p>如何根据点击的鼠标位置来决定使用哪个方向的图集?</p>
</blockquote>
<h3 id="分解问题"><a href="#分解问题" class="headerlink" title="分解问题"></a>分解问题</h3><ul>
<li><p>首先8方向图集 <code>360/8 = 45</code> 也就是每45度一个图集. 然要注意起始角度并不是0度.</p>
<blockquote>
<p>不是0~45度 是图集A, 而应该是 -22.5~22.5 是图集A ,22.5 ~ 67.5(22.5+45) 是图集B  以此类推</p>
</blockquote>
</li>
<li><p>根据当前Touch(PosB),和上次Touch(PosA) 做一个向量AB , 只要求的该向量AB和Up向量(Vector2.up)之间的夹角即可</p>
</li>
</ul>
<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><p>方法一:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> angle = Vector2.Angle(toVector2,Vector2.up);</span><br><span class="line"><span class="keyword">var</span> cross = Vector3.Cross(toVector2,Vector2.up);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (cross.z &lt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">   angle = <span class="number">360</span> - angle;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>方法二:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> angle = Vector2.SignedAngle(toVector2, Vector2.up);</span><br><span class="line"><span class="keyword">if</span> (angle &lt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    angle = <span class="number">360</span> + angle;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><p>方法一是之前一直使用的,方法二是后来发现API中有的.也许是新加入的?(2017.1). </p>
<p>先从方法一说起.</p>
<p>首先是</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> angle = Vector2.Angle(Vector2.up, toVector2);</span><br></pre></td></tr></table></figure>
<p>取得角度这个方法,这个是无符号的.<a href="https://docs.unity3d.com/ScriptReference/Vector2.Angle.html" target="_blank" rel="noopener">官网的API文档</a>说的很清楚了</p>
<blockquote>
<p>The angle returned is the unsigned acute angle between the two vectors. This means the smaller of the two possible angles between the two vectors is used. The result is never greater than 180 degrees.</p>
</blockquote>
<p>也就是能取到的是最小夹角,比如返回一个30度. 你无法知道是30度还是330度(360-30).</p>
<p>这个就需要使用到 <code>叉乘</code>来判断了.</p>
<p><img src="http://p09vx6soj.bkt.clouddn.com/向量叉乘公式.png" alt="向量叉乘公式"></p>
<p>首先 <code>叉乘</code> 只能用于3D向量,但是确实又允许<code>Vector3.Cross(Vector2.up, toVector2)</code>这么写.</p>
<p>这个就可以把 <code>Vector2.up</code>和<code>toVector2</code>看成<code>x-y</code>平面的向量,其z=0.</p>
<p>那么他的<code>叉积</code>就是和<code>z</code>轴共线的向量</p>
<p><img src="http://p09vx6soj.bkt.clouddn.com/叉乘公式.png" alt="叉乘公式"></p>
<p>因为,<code>Vector2.up</code>和<code>toVector2</code>的z均为零,所以</p>
<p>两向量叉乘得到向量为(0,0,z)</p>
<p>同时又根据上面的公式 c的模=a的模 x b的模 x sin@. </p>
<p>c的模 也就是 z</p>
<p>然后再根据正弦函数</p>
<p><img src="http://p09vx6soj.bkt.clouddn.com/Sin取值范围.png" alt="Sin取值范围"></p>
<p>可以知道. 当sin@&lt;0 时候 也就是此时得到角度是大于180的.</p>
<p>比如上面angle给出来的是30度, 那么就需要用 360-30 得到 330度.</p>
<h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><p><img src="http://p09vx6soj.bkt.clouddn.com/WX20180630-011249.png" alt="WX20180630-011249"></p>
<p>直接进到其API的实现就可以看到了</p>
<ul>
<li>红框部分就是 <code>var angle = Vector2.Angle(Vector2.up, toVector2);</code></li>
<li>篮框部分就是 <code>z</code>值 </li>
</ul>
<p>叉积向量</p>
<p>x = y1z2 - z1y2<br>y = z1x2 - x1z2<br>z = x1y2 - y1x2</p>
<p>因为z1和z2都是0,所以叉积就是向量(0,0,x1y2 - y1x2)</p>
<p>换句话说就是 方法二 其实就是封装后的 方法一</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.oldking.wang/a2479e30-5e4f-11e8-8089-63130c1b42ee/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="隔壁老王">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="隔壁老王">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/a2479e30-5e4f-11e8-8089-63130c1b42ee/" itemprop="url">Egret Wing自定义快捷键Mac</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-23T14:07:55+08:00">
                2018-05-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>修改<code>keybindings.json</code><br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">// 将键绑定放入此文件中以覆盖默认值</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"comment"</span>: <span class="string">"格式化"</span>,</span><br><span class="line">        <span class="attr">"key"</span>: <span class="string">"shift+cmd+f"</span>,</span><br><span class="line">        <span class="attr">"command"</span>: <span class="string">"editor.action.formatDocument"</span>,</span><br><span class="line">        <span class="attr">"when"</span>: <span class="string">"editorHasDocumentFormattingProvider &amp;&amp; editorTextFocus &amp;&amp; !editorReadonly"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"comment"</span>: <span class="string">"搜索引用"</span>,</span><br><span class="line">        <span class="attr">"key"</span>: <span class="string">"shift+cmd+g"</span>,</span><br><span class="line">        <span class="attr">"command"</span>: <span class="string">"editor.action.referenceSearch.trigger"</span>,</span><br><span class="line">        <span class="attr">"when"</span>: <span class="string">"editorHasReferenceProvider &amp;&amp; editorTextFocus &amp;&amp; !inReferenceSearchEditor"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"comment"</span>: <span class="string">"跳转到定义"</span>,</span><br><span class="line">        <span class="attr">"key"</span>: <span class="string">"f3"</span>,</span><br><span class="line">        <span class="attr">"command"</span>: <span class="string">"editor.action.goToDeclaration"</span>,</span><br><span class="line">        <span class="attr">"when"</span>: <span class="string">"editorHasDefinitionProvider &amp;&amp; editorTextFocus"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"comment"</span>: <span class="string">"返回上一个"</span>,</span><br><span class="line">        <span class="attr">"key"</span>: <span class="string">"alt+left"</span>,</span><br><span class="line">        <span class="attr">"command"</span>: <span class="string">"workbench.action.navigateBack"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"comment"</span>: <span class="string">"前进下一个"</span>,</span><br><span class="line">        <span class="attr">"key"</span>: <span class="string">"alt+right"</span>,</span><br><span class="line">        <span class="attr">"command"</span>: <span class="string">"workbench.action.navigateForward"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"comment"</span>: <span class="string">"删除一行"</span>,</span><br><span class="line">        <span class="attr">"key"</span>: <span class="string">"cmd+d"</span>,</span><br><span class="line">        <span class="attr">"command"</span>: <span class="string">"editor.action.deleteLines"</span>,</span><br><span class="line">        <span class="attr">"when"</span>: <span class="string">"editorTextFocus &amp;&amp; !editorReadonly"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"comment"</span>: <span class="string">"代码提示"</span>,</span><br><span class="line">        <span class="attr">"key"</span>: <span class="string">"alt+/"</span>,</span><br><span class="line">        <span class="attr">"command"</span>: <span class="string">"editor.action.triggerSuggest"</span>,</span><br><span class="line">        <span class="attr">"when"</span>: <span class="string">"editorHasCompletionItemProvider &amp;&amp; editorTextFocus &amp;&amp; !editorReadonly"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"comment"</span>: <span class="string">"快速打开"</span>,</span><br><span class="line">        <span class="attr">"key"</span>: <span class="string">"shift+cmd+t"</span>,</span><br><span class="line">        <span class="attr">"command"</span>: <span class="string">"workbench.action.quickOpen"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"comment"</span>: <span class="string">"编译"</span>,</span><br><span class="line">        <span class="attr">"key"</span>: <span class="string">"cmd+b"</span>,</span><br><span class="line">        <span class="attr">"command"</span>: <span class="string">"workbench.action.tasks.build"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"comment"</span>: <span class="string">"Debug:单步跳过"</span>,</span><br><span class="line">        <span class="attr">"key"</span>: <span class="string">"f6"</span>,</span><br><span class="line">        <span class="attr">"command"</span>: <span class="string">"workbench.action.debug.stepOver"</span>,</span><br><span class="line">        <span class="attr">"when"</span>: <span class="string">"inDebugMode"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"comment"</span>: <span class="string">"Debug:单步进入"</span>,</span><br><span class="line">        <span class="attr">"key"</span>: <span class="string">"f5"</span>,</span><br><span class="line">        <span class="attr">"command"</span>: <span class="string">"workbench.action.debug.stepInto"</span>,</span><br><span class="line">        <span class="attr">"when"</span>: <span class="string">"inDebugMode"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"comment"</span>: <span class="string">"Debug:继续"</span>,</span><br><span class="line">        <span class="attr">"key"</span>: <span class="string">"f8"</span>,</span><br><span class="line">        <span class="attr">"command"</span>: <span class="string">"workbench.action.debug.continue"</span>,</span><br><span class="line">        <span class="attr">"when"</span>: <span class="string">"inDebugMode"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"comment"</span>: <span class="string">"Run调试模式"</span>,</span><br><span class="line">        <span class="attr">"key"</span>: <span class="string">"f4"</span>,</span><br><span class="line">        <span class="attr">"command"</span>: <span class="string">"workbench.action.debug.run"</span>,</span><br><span class="line">        <span class="attr">"when"</span>: <span class="string">"!inDebugMode"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"comment"</span>: <span class="string">"重命名"</span>,</span><br><span class="line">        <span class="attr">"key"</span>: <span class="string">"f2"</span>,</span><br><span class="line">        <span class="attr">"command"</span>: <span class="string">"editor.action.rename"</span>,</span><br><span class="line">        <span class="attr">"when"</span>: <span class="string">"editorHasRenameProvider &amp;&amp; editorTextFocus &amp;&amp; !editorReadonly"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"comment"</span>: <span class="string">"注释"</span>,</span><br><span class="line">        <span class="attr">"key"</span>: <span class="string">"ctrl+/"</span>,</span><br><span class="line">        <span class="attr">"command"</span>: <span class="string">"editor.action.commentLine"</span>,</span><br><span class="line">        <span class="attr">"when"</span>: <span class="string">"editorTextFocus &amp;&amp; !editorReadonly"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"comment"</span>: <span class="string">"当前行向下移"</span>,</span><br><span class="line">        <span class="attr">"key"</span>: <span class="string">"alt+down"</span>,</span><br><span class="line">        <span class="attr">"command"</span>: <span class="string">"editor.action.moveLinesDownAction"</span>,</span><br><span class="line">        <span class="attr">"when"</span>: <span class="string">"editorTextFocus &amp;&amp; !editorReadonly"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"comment"</span>: <span class="string">"当前行向上移"</span>,</span><br><span class="line">        <span class="attr">"key"</span>: <span class="string">"alt+up"</span>,</span><br><span class="line">        <span class="attr">"command"</span>: <span class="string">"editor.action.moveLinesUpAction"</span>,</span><br><span class="line">        <span class="attr">"when"</span>: <span class="string">"editorTextFocus &amp;&amp; !editorReadonly"</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.oldking.wang/30ae8bd0-55e4-11e8-aeef-7d501aa687e4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="隔壁老王">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="隔壁老王">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/30ae8bd0-55e4-11e8-aeef-7d501aa687e4/" itemprop="url">Odin - Inspector and Serializer 使用手札</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-12T20:58:39+08:00">
                2018-05-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Unity/" itemprop="url" rel="index">
                    <span itemprop="name">Unity</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Odin-Inspector-and-Serializer"><a href="#Odin-Inspector-and-Serializer" class="headerlink" title="Odin - Inspector and Serializer"></a>Odin - Inspector and Serializer</h2><p><a href="https://assetstore.unity.com/packages/tools/utilities/odin-inspector-and-serializer-89041" target="_blank" rel="noopener">Odin - Inspector and Serializer</a> 是Unity一个超级好用的编辑器扩展插件.</p>
<p><img src="http://p09vx6soj.bkt.clouddn.com/0a15170a-a8f1-4343-a0d1-99718c9bee52.jpg" alt="0a15170a-a8f1-4343-a0d1-99718c9bee52"></p>
<p>如果还没有用过,建议去尝试一下. </p>
<h2 id="手札"><a href="#手札" class="headerlink" title="手札"></a>手札</h2><h3 id="修改在Inspector中显示的名字"><a href="#修改在Inspector中显示的名字" class="headerlink" title="修改在Inspector中显示的名字"></a>修改在Inspector中显示的名字</h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">LabelText(<span class="meta-string">"血量"</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> blood;</span><br></pre></td></tr></table></figure>
<h3 id="如果条件达成则显示"><a href="#如果条件达成则显示" class="headerlink" title="如果条件达成则显示"></a>如果条件达成则显示</h3><p>标签包含 <code>ShowIf,HideIf,EnableIf,DisableIf</code>, 同时支持枚举类型</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">bool</span> isShowBlood;</span><br><span class="line"></span><br><span class="line">[<span class="meta">ShowIf(<span class="meta-string">"isShowBlood"</span>),[LabelText(<span class="meta-string">"血量"</span>)</span>]]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> blood;</span><br></pre></td></tr></table></figure>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> InfoMessageType</span><br><span class="line">&#123;</span><br><span class="line">    None,</span><br><span class="line">    Info,</span><br><span class="line">    Warning,</span><br><span class="line">    Error,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ShowAndHideIfExamples</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">EnumToggleButtons</span>]</span><br><span class="line">    <span class="keyword">public</span> InfoMessageType SomeEnum;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">bool</span> IsToggled;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">ShowIf(<span class="meta-string">"SomeEnum"</span>, InfoMessageType.Info)</span>]</span><br><span class="line">    <span class="keyword">public</span> Vector3 Info;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">ShowIf(<span class="meta-string">"SomeEnum"</span>, InfoMessageType.Warning)</span>]</span><br><span class="line">    <span class="keyword">public</span> Vector2 Warning;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">ShowIf(<span class="meta-string">"SomeEnum"</span>, InfoMessageType.Error)</span>]</span><br><span class="line">    <span class="keyword">public</span> Vector3 Error;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">ShowIf(<span class="meta-string">"IsToggled"</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> Vector2 VisibleWhenToggled;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">HideIf(<span class="meta-string">"IsToggled"</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> Vector3 HiddenWhenToggled;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.oldking.wang/9bae8910-3994-11e8-bcca-ef87fcce56f0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="隔壁老王">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="隔壁老王">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/9bae8910-3994-11e8-bcca-ef87fcce56f0/" itemprop="url">使用Obfuscator对代码进行混淆</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-06T20:18:26+08:00">
                2018-04-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Unity/" itemprop="url" rel="index">
                    <span itemprop="name">Unity</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>游戏上线后,遭到各种各样的破解. 前期还仅仅是尝试改改内存,这个还好 虽然后来也被破解了.但是应对方法比较简单.</p>
<p>后来<code>GG大玩家</code>居然直接<code>Dll Hook</code>挂Mod… 太看得起我了-.-</p>
<h2 id="防御"><a href="#防御" class="headerlink" title="防御"></a>防御</h2><p>虽然可以做dll注入防护(原理应该是给自己用到的所有Dll做白名单,其他的一概不允许),不过考虑到接入那么多渠道.再做这部分的防护. 一键打包脚本 应该是个巨大的工作量.所以还是放弃了..</p>
<h2 id="Obfuscator"><a href="#Obfuscator" class="headerlink" title="Obfuscator"></a>Obfuscator</h2><p><code>Obfuscator</code>是AssetStore上很火的一个插件,可以进行代码混淆并且生成<code>伪函数</code>,对于注入来说应该会加大不少难度. 希望<code>GG大玩家</code>的<code>Hacker</code>们会喜欢. 期待你们的下次破解~~</p>
<h3 id="测试工程"><a href="#测试工程" class="headerlink" title="测试工程"></a>测试工程</h3><p>写一个标准的<code>MVC</code>,界面两个按钮. 一个控制加分数,一个控制减分数</p>
<p><strong>UI层</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UIMediator</span> :</span> MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnClickAddScoreBtn</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ScoreVoManger.instance.GetVo().num += <span class="number">1</span>;</span><br><span class="line">        Debug.Log(<span class="string">"On click add score btn"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnClickSubScoreBtn</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ScoreVoManger.instance.GetVo().num -= <span class="number">1</span>;</span><br><span class="line">        Debug.Log(<span class="string">"On click sub score btn"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>VoHandler</strong><br><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">public class ScoreVoManger</span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword"> private</span><span class="keyword"> static</span> ScoreVoManger mInstance;</span><br><span class="line"></span><br><span class="line">   <span class="keyword"> public</span><span class="keyword"> static</span> ScoreVoManger<span class="built_in"> instance </span>=&gt; mInstance ?? (mInstance =<span class="built_in"> new </span>ScoreVoManger());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="keyword"> private</span> readonly ScoreVo mVo;</span><br><span class="line"></span><br><span class="line">   <span class="keyword"> private</span> ScoreVoManger()</span><br><span class="line">    &#123;</span><br><span class="line">        mVo =<span class="built_in"> new </span>ScoreVo();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword"> public</span> void ChangeScore(int _addValue)</span><br><span class="line">    &#123;</span><br><span class="line">        mVo.num += _addValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword"> public</span> ScoreVo GetVo()</span><br><span class="line">    &#123;</span><br><span class="line">       <span class="built_in"> return </span>mVo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>Vo</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScoreVo</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> num;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ScoreVo</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        num = <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="效果截图"><a href="#效果截图" class="headerlink" title="效果截图"></a>效果截图</h3><p>直接使用<code>Obfuscator</code>默认参数. 编译后Dump出代码</p>
<p><img src="http://p09vx6soj.bkt.clouddn.com/WX20180406-203428.png" alt="WX20180406-203428"></p>
<h2 id="Update-v1"><a href="#Update-v1" class="headerlink" title="Update v1"></a>Update v1</h2><p>把<code>Obfuscator</code>用到正式的项目中去还是走了不少弯路的. 总结一下遇到的几个问题</p>
<h3 id="Json"><a href="#Json" class="headerlink" title="Json"></a>Json</h3><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JsonUtility.FromJson&lt;ClassName&gt;<span class="comment">(**Json字符串**)</span>;</span><br></pre></td></tr></table></figure>
<p>对于需要从Jaon中直接序列化与反序列化的对象,需要在对应的Class上面标记[Skip]</p>
<h3 id="Plugins目录"><a href="#Plugins目录" class="headerlink" title="Plugins目录"></a>Plugins目录</h3><p><code>Obfuscator</code>不会对<code>Plugins</code>目录下的代码进行混淆,但是有些插件并不是默认放入该目录下,需要对相应插件进行目录迁移</p>
<h3 id="Behavior-Designer"><a href="#Behavior-Designer" class="headerlink" title="Behavior Designer"></a>Behavior Designer</h3><p>所有<code>Behavior Designer</code>用到的Class均要设置为[Skip],他的说明文档里面也有提到.</p>
<h3 id="Enum"><a href="#Enum" class="headerlink" title="Enum"></a>Enum</h3><p>这个折腾了好久. 所有枚举变量均要设置[SkipRename],即使对应的Class已经设置了[Skip].也要设置</p>
<h3 id="IL2CPP"><a href="#IL2CPP" class="headerlink" title="IL2CPP"></a>IL2CPP</h3><p><code>IL2CPP</code>模式下,开混淆后不可开调试模式(Development Build).否则会编译报错.</p>
<h2 id="建议"><a href="#建议" class="headerlink" title="建议"></a>建议</h2><ul>
<li>项目尽早集成<code>Obfuscator</code>,且多上真机看效果.后期集成不可预知性太高,早起集成还可以让所有UI中函数加入[Skip]标签,这样可以对MonoObject进行混淆.加大扰码力度</li>
<li>尽量少使用<code>Invoke</code>,如果需要也最好集中处理(<code>CopyEngine.CallLater(_callback,_delayTime)</code>),并且要使用nameof(函数名),否则混淆不一定可用</li>
<li>不使用enum,直接使用const int变量.这样可以做混淆</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.oldking.wang/7fe419b0-3657-11e8-b4e4-cb31989e149f/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="隔壁老王">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="隔壁老王">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/7fe419b0-3657-11e8-b4e4-cb31989e149f/" itemprop="url">Unity中使用JsonObject插件动态序列与反序列化对象</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-02T17:23:27+08:00">
                2018-04-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Unity/" itemprop="url" rel="index">
                    <span itemprop="name">Unity</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>游戏的存档是放在客户端的,之前是直接使用的二进制序列化</p>
<blockquote>
<p>对象标记<code>[Serializable]</code>标签,然后直接转换成二进制文件</p>
</blockquote>
<p>这样操作乍看没问题,但是当上线后需要加入新功能,问题就暴露出来了</p>
<p>玩家此时已经有本地存档了,当我对本地<code>Vo对象</code>加入新属性时候,二进制代码无法和Class进行对应.于是乎就会出现 旧存档无法使用的情况.</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>需要找到一种 可以在Class已经发生更新后,仍旧可以用旧的存档进行反序列化的方法.</p>
<p>能想到的有两种. 一种是Google的<code>Protobuf</code>,一种是<code>Json</code>.</p>
<p><code>Protobuf</code>只要保证新加入的key是向后延续的,就可以兼容之前的数据.</p>
<p><code>Json</code>的话,如果用Unity内置的Json类是无法实现的,因为他需要做Json-Objecet的映射.不过<code>JsonObject</code>这个插件可以实现动态解析.</p>
<h2 id="我的选择"><a href="#我的选择" class="headerlink" title="我的选择"></a>我的选择</h2><p><code>Protobuf</code>的话 主要是体积小,一般用于网络传输. 我主要是用于游戏存档.整体存档数据不大.所以<code>JsonObject</code>更适合我.</p>
<p>并且其代码很简洁,后期自己如果有一些特殊需求,扩展起来也会很方便的.</p>
<h2 id="JsonObject"><a href="#JsonObject" class="headerlink" title="JsonObject"></a>JsonObject</h2><h3 id="下载地址"><a href="#下载地址" class="headerlink" title="下载地址"></a>下载地址</h3><p><a href="https://assetstore.unity.com/packages/tools/input-management/json-object-710" target="_blank" rel="noopener">Unity AssetsStore</a><br><a href="https://github.com/mtschoen/JSONObject" target="_blank" rel="noopener">GitHub(推荐)</a></p>
<h3 id="核心代码"><a href="#核心代码" class="headerlink" title="核心代码"></a>核心代码</h3><p>TeamVo</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> Code;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Team</span> : <span class="title">ICEJsonSerializable</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">string</span> TEAM_NAME = <span class="string">"a"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">string</span> ALL_MEMBER_LIST = <span class="string">"b"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">string</span> CITY = <span class="string">"c"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> teamName;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Person&gt; allMembersList;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//New</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> city;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Team</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        allMembersList = <span class="keyword">new</span> List&lt;Person&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">FromJson</span>(<span class="params">JSONObject _jsonObject</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        _jsonObject.GetField(ALL_MEMBER_LIST, _obj =&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> menberObj <span class="keyword">in</span> _obj.list)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> person = <span class="keyword">new</span> Person();</span><br><span class="line">                person.FromJson(menberObj);</span><br><span class="line">                allMembersList.Add(person);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        _jsonObject.GetField(TEAM_NAME, _obj =&gt; &#123; teamName = _obj.str; &#125;, name =&gt; &#123; teamName = <span class="string">"NotSet"</span>; &#125;);</span><br><span class="line">        _jsonObject.GetField(CITY, _obj =&gt; &#123; city = _obj.str; &#125;, _notFound =&gt; &#123; city = <span class="string">"NotFound"</span>; &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JSONObject <span class="title">ToJsonObject</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> returnObj = <span class="keyword">new</span> JSONObject();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> menberList = <span class="keyword">new</span> JSONObject(JSONObject.Type.ARRAY);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> person <span class="keyword">in</span> allMembersList)</span><br><span class="line">        &#123;</span><br><span class="line">            menberList.Add(person.ToJsonObject());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        returnObj.AddField(ALL_MEMBER_LIST, menberList);</span><br><span class="line">        returnObj.AddField(TEAM_NAME, teamName);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> returnObj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//序列化方法</span></span><br><span class="line"><span class="keyword">var</span> json = team.ToJsonObject();</span><br><span class="line"><span class="keyword">var</span> str = json.ToString();</span><br><span class="line"></span><br><span class="line"><span class="comment">//反序列化</span></span><br><span class="line"><span class="keyword">var</span> team = <span class="keyword">new</span> <span class="type">Team</span>();</span><br><span class="line">team.FromJson(<span class="keyword">new</span> <span class="type">JSONObject</span>(str));</span><br></pre></td></tr></table></figure>
<h3 id="代码说明"><a href="#代码说明" class="headerlink" title="代码说明"></a>代码说明</h3><p>序列化部分比较简单,所有Vo对象实现 序列化反序列化接口.然后递归创建<code>JsonObject</code>即可</p>
<p>反序列化<code>JsonObject</code>处理比较好的部分是</p>
<p><code>_jsonObject.GetField(key,成功回调,失败回调)</code></p>
<p>也就是取数据使用回调函数</p>
<p>比如像<code>TeamVo</code>中,我第一次序列化时候并不包含<code>city</code>字段. 当我序列化成功后,给<code>TeamVo</code>中加入<code>city</code>字段</p>
<p>再读取之前序列化好的Json(进行反序列化). </p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">_jsonObject</span>.GetField(CITY, <span class="variable">_obj</span> =&gt; &#123; city = <span class="variable">_obj</span>.<span class="built_in">str</span>; &#125;, <span class="variable">_notFound</span> =&gt; &#123; city = <span class="string">"NotFound"</span>; &#125;);</span><br></pre></td></tr></table></figure>
<p>我就可以很轻松的兼容旧的序列化文件.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.oldking.wang/00e482d0-3558-11e8-bda2-bf71a18d2be3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="隔壁老王">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="隔壁老王">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/00e482d0-3558-11e8-bda2-bf71a18d2be3/" itemprop="url">Unity新版AssetBundles使用手札</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-01T10:54:32+08:00">
                2018-04-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Unity/" itemprop="url" rel="index">
                    <span itemprop="name">Unity</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="使用目的"><a href="#使用目的" class="headerlink" title="使用目的"></a>使用目的</h3><p>之前的项目(单机弱联网),所有资源一直放置在<code>Resources</code>目录,后来因为期望将配置文件放到服务器.可以实现<code>不发版本从而更新配置文件的</code>目的 开始接触<code>AssetBundles</code></p>
<h3 id="生成AssetBundles"><a href="#生成AssetBundles" class="headerlink" title="生成AssetBundles"></a>生成AssetBundles</h3><p>新版的<code>AssetBundles</code>(Unity 5.0+,2017,2018…) 相比旧版省事很多.看了下<a href="https://docs.unity3d.com/ScriptReference/BuildPipeline.html" target="_blank" rel="noopener">API</a>原有的函数</p>
<p><code>BuildPipeline.BuildAssetBundle</code>已经被<strong>弃用</strong>了.目前AB应该只使用</p>
<p><code>BuildPipeline.BuildAssetBundles</code> 进行全部的AB文件打包.</p>
<h4 id="打包代码"><a href="#打包代码" class="headerlink" title="打包代码"></a>打包代码</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">MenuItem(<span class="meta-string">"CopyEngine/AssetBundles/Build All"</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">BuildAllAssetBundles</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (Directory.Exists(FOLDER_PATH))</span><br><span class="line">    &#123;</span><br><span class="line">        CEOneKeyReleaseUtils.DeleteFolder(FOLDER_PATH);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Directory.CreateDirectory(FOLDER_PATH);</span><br><span class="line"></span><br><span class="line">    DoBuildBundles(<span class="string">"Mac"</span>, BuildTarget.StandaloneOSX);</span><br><span class="line">    DoBuildBundles(<span class="string">"Android"</span>, BuildTarget.Android);</span><br><span class="line">    DoBuildBundles(<span class="string">"IOS"</span>, BuildTarget.iOS);</span><br><span class="line">    DoBuildBundles(<span class="string">"Win"</span>, BuildTarget.StandaloneWindows);</span><br><span class="line">    Caching.ClearCache();</span><br><span class="line">    AssetDatabase.Refresh();</span><br><span class="line">    Debug.Log(<span class="string">"Done build all assets bundles"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">DoBuildBundles</span>(<span class="params"><span class="keyword">string</span> _subFolder, BuildTarget _target</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> assetBundleDirectory = FOLDER_PATH + <span class="string">"/"</span> + _subFolder;</span><br><span class="line">    <span class="keyword">if</span> (!Directory.Exists(assetBundleDirectory))</span><br><span class="line">    &#123;</span><br><span class="line">        Directory.CreateDirectory(assetBundleDirectory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    BuildPipeline.BuildAssetBundles(assetBundleDirectory, BuildAssetBundleOptions.None, _target);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="缓存机制"><a href="#缓存机制" class="headerlink" title="缓存机制"></a>缓存机制</h3><p>缓存基础知识可以参考<a href="https://unity3d.com/cn/learn/tutorials/topics/best-practices/assetbundle-usage-patterns" target="_blank" rel="noopener">AssetBundle usage patterns</a>的<code>4.2.1. Shipped with project</code>~<code>4.2.3. Built-in caching</code>这块.</p>
<p>核心部分就是使用<code>UnityWebRequest</code>下载并读取<code>AB</code></p>
<h4 id="核心代码"><a href="#核心代码" class="headerlink" title="核心代码"></a>核心代码</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mUrl为请求地址</span></span><br><span class="line"><span class="comment">//mHash是用作缓存的Hash值,从AssetBundleManifest中取得</span></span><br><span class="line"><span class="keyword">using</span> (<span class="keyword">var</span> uwr = UnityWebRequest.GetAssetBundle(mUrl, mHash, <span class="number">0</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">return</span> uwr.SendWebRequest();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (uwr.isNetworkError || uwr.isHttpError)</span><br><span class="line">    &#123;</span><br><span class="line">        Debug.LogError(<span class="string">"[CEAB] get ab on error:\n"</span> + uwr.error + <span class="string">"\nURL:"</span> + mUrl);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> bundle = DownloadHandlerAssetBundle.GetContent(uwr);</span><br><span class="line">        <span class="comment">//做自己的操作</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="AssetBundleManifest"><a href="#AssetBundleManifest" class="headerlink" title="AssetBundleManifest"></a>AssetBundleManifest</h3><p>首先要注意的是,使用<code>BuildPipeline.BuildAssetBundles</code>打包生成<code>AB</code>目录,会有两个<code>AssetBundleManifest</code>文件. 比如上面的打包代码</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">DoBuildBundles</span>(<span class="string">"Android"</span>, BuildTarget.Android);</span><br></pre></td></tr></table></figure>
<p>会在指定的目录下生成一个名叫<code>Android</code>的目录,其内部放置的<code>AB</code>素材是适合安卓平台下使用的. 同时会产生一个 名字叫<code>Android</code>但是没有后缀,另外一个有<code>manifest</code>后缀的文件(Android.manifest)</p>
<p><code>Android.manifest</code>这个文件<strong>不是</strong>真正的<code>AssetBundleManifest</code>,没有文件名的那个文件才是.</p>
<p><code>*.manifest</code>在旧版的API文档(低于Unity5.0)中有说明,是用于内部构建使用,也就是可以直接忽略不管的.</p>
<p>真正需要加载的文件是没有文件名的那个.</p>
<h3 id="将AB文件放入StreamingAssets"><a href="#将AB文件放入StreamingAssets" class="headerlink" title="将AB文件放入StreamingAssets"></a>将AB文件放入StreamingAssets</h3><p>将AB放入或者不放入<code>StreamingAssets</code>要看项目而定. 主要是在包体大小和进入等待时间之间做一个平衡吧.</p>
<h4 id="核心代码-1"><a href="#核心代码-1" class="headerlink" title="核心代码"></a>核心代码</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">CEABConfig</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="keyword">string</span> STREAMING_PATH_URL =</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> UNITY_EDITOR</span></span><br><span class="line">        Application.dataPath + <span class="string">"/StreamingAssets/AssetBundles/"</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">elif</span> UNITY_ANDROID</span></span><br><span class="line">        <span class="string">"jar:file://"</span> + Application.dataPath + <span class="string">"!/assets/AssetBundles/"</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">elif</span> UNITY_IPHONE</span></span><br><span class="line">        Application.dataPath + <span class="string">"/Raw/AssetBundles/"</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">elif</span> UNITY_STANDALONE</span></span><br><span class="line">        Application.dataPath + <span class="string">"/StreamingAssets/AssetBundles/"</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">        <span class="keyword">string</span>.Empty;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="keyword">string</span> PLATFORM =</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> UNITY_EDITOR_WIN</span></span><br><span class="line">        <span class="string">"Win"</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">elif</span> UNITY_EDITOR_OSX</span></span><br><span class="line">        <span class="string">"Mac"</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">elif</span> UNITY_ANDROID</span></span><br><span class="line">        <span class="string">"Android"</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">elif</span> UNITY_IPHONE</span></span><br><span class="line">        <span class="string">"IOS"</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">elif</span> UNITY_STANDALONE_WIN</span></span><br><span class="line">        <span class="string">"Win"</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">elif</span> UNITY_STANDALONE_OSX</span></span><br><span class="line">        <span class="string">"Mac"</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">        <span class="keyword">string</span>.Empty;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//调用方式:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> localFilePath = CEABConfig.STREAMING_PATH_URL + CEABConfig.PLATFORM + <span class="string">"/"</span> + _abName;</span><br><span class="line"><span class="keyword">var</span> bundle = AssetBundle.LoadFromFile(localFilePath);</span><br></pre></td></tr></table></figure>
<h4 id="补充说明"><a href="#补充说明" class="headerlink" title="补充说明"></a>补充说明</h4><p>在安卓平台<code>StreamingAssets</code>中的文件是放入一个<code>jar</code>包之中保存的,所以正常的方法是<strong>无法</strong>查找某一个文件是否存在的.</p>
<p>比如在Editor或者Standalone中是可以直接用<code>File.Exist(xxx)</code>判断是否存在某一个<code>AB</code>,从而决定是从<code>StreamingAssets</code>中加载还是从<code>UnityWebRequest</code>中请求.</p>
<p>但是在安卓中是不可以.</p>
<p>目前我想到的是两种方式, 一种是在生成AB包时候同时生成相应的配置文件,通过该文件来实现<code>File.Exist(xxx)</code>的逻辑.</p>
<p>另外一种是使用try-catch然后直接生取对应的AB文件. 进行异常监听. </p>
<p>目前我项目中使用的是第二种方式.</p>
<h3 id="我AB的使用方式"><a href="#我AB的使用方式" class="headerlink" title="我AB的使用方式"></a>我AB的使用方式</h3><p>目前我项目中的<code>AB</code>使用流程如下</p>
<p><strong>1–&gt;</strong> 使用文章开头提供的脚本在单独的项目中打包所有<code>AB</code></p>
<blockquote>
<p>使用单独项目原因是,如果主项目很大,每次打包要好久. 将需要打包的资源单独放置一个新项目中会快很多</p>
</blockquote>
<p><strong>2–&gt;</strong> 将生成好的全平台(“Mac”,”Windows”,”Android”,”IOS”)AB,Copy到主项目的<code>StreamingAssets</code>目录下</p>
<p>同时Copy一份到主目录外(用于一键打包脚本)</p>
<blockquote>
<p>这样做的好处是在开发阶段测试很方便,打包每个平台的测试工程均可,且无需联网下载<code>AB</code></p>
<p>(代码中需要设置,在测试环境中只使用<code>StreamingAssets</code>中的AB)</p>
</blockquote>
<p><strong>3–&gt;</strong> 使用一键发布脚本进行安卓或者IOS平台打包:</p>
<p>首先删除<code>StreamingAssets</code>目录下的全平台AB<br>再根据平台不同,将主目录外的备份文件.相应的Copy进来</p>
<p><strong>4–&gt;</strong> 正式工程取得某个AB时候</p>
<p>首先请求<code>AssetBundleManifest</code>文件(从服务器请求,不缓存)</p>
<p>然后从中取得该<code>AB</code>的Hash值. 用该值和<code>StreamingAssets</code>中的<code>AB</code>进行比较. 如果相同则直接从<code>StreamingAssets</code>中加载.(注意,<strong>不能</strong>使用<code>UnityWebRequest</code>进行加载,否则会复制出一份缓存文件来).</p>
<p>如果不相同,则使用该<code>Hash</code>做key 通过<code>UnityWebRequest</code>请求. 这样会把相应的<code>AB</code>缓存下来. 下次不需要再从服务器中下载.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.oldking.wang/c6660210-17ba-11e8-9e87-45e9f0e9cada/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="隔壁老王">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="隔壁老王">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/c6660210-17ba-11e8-9e87-45e9f0e9cada/" itemprop="url">ShareSDK配置手札</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-22T18:25:59+08:00">
                2018-02-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="修改步骤"><a href="#修改步骤" class="headerlink" title="修改步骤"></a>修改步骤</h2><h3 id="修改-ShareSDKUnity3DBridge"><a href="#修改-ShareSDKUnity3DBridge" class="headerlink" title="修改 ShareSDKUnity3DBridge"></a>修改 ShareSDKUnity3DBridge</h3><p>编辑ShareSDKUnity3DBridge.m文件. 在Finder中打开,ShareSDK的IOS目录下</p>
<p><img src="http://p09vx6soj.bkt.clouddn.com/QQ20180222-182851.jpg" alt="QQ20180222-182851"></p>
<p><img src="http://p09vx6soj.bkt.clouddn.com/QQ20180222-182921.jpg" alt="QQ20180222-182921"></p>
<p>注释掉所有不使用的平台</p>
<h3 id="ShareSDK-cs"><a href="#ShareSDK-cs" class="headerlink" title="ShareSDK.cs"></a>ShareSDK.cs</h3><p>替换ShareSDK中的appKey和appSecret为自己的Key</p>
<h3 id="DevInfoSet-cs"><a href="#DevInfoSet-cs" class="headerlink" title="DevInfoSet.cs"></a>DevInfoSet.cs</h3><p>修改其内部的所有<code>app_key</code>和<code>app_secret</code>等相应信息为自己的</p>
<h3 id="ChosenPlatforms-cs"><a href="#ChosenPlatforms-cs" class="headerlink" title="ChosenPlatforms.cs"></a>ChosenPlatforms.cs</h3><p>修改其内部所有用不到的平台<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.XXXX[<span class="string">"chosen"</span>] = <span class="literal">false</span>;</span><br></pre></td></tr></table></figure></p>
<h3 id="EditorUI-cs"><a href="#EditorUI-cs" class="headerlink" title="EditorUI.cs"></a>EditorUI.cs</h3><p>更改OnInspectorGUI函数为</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public override void OnInspectorGUI()</span><br><span class="line">       &#123;</span><br><span class="line">           EditorGUILayout<span class="meta">.Space</span>()<span class="comment">;</span></span><br><span class="line">           EditorGUILayout.LabelField(<span class="string">"点击保存"</span>)<span class="comment">;</span></span><br><span class="line">           EditorGUILayout<span class="meta">.Space</span>()<span class="comment">;</span></span><br><span class="line">           if (GUILayout.<span class="keyword">Button("保存"))</span></span><br><span class="line"><span class="keyword"> </span>          &#123;</span><br><span class="line">               Save()<span class="comment">;</span></span><br><span class="line">               <span class="built_in">Debug</span>.Log(<span class="string">"Done Save"</span>)<span class="comment">;</span></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<h3 id="ShareSDKPostProcessBuild-cs"><a href="#ShareSDKPostProcessBuild-cs" class="headerlink" title="ShareSDKPostProcessBuild.cs"></a>ShareSDKPostProcessBuild.cs</h3><p>更改<code>EditInfoPlist</code>函数内部的URL Scheme为自己对应的key</p>
<h3 id="移动SDK"><a href="#移动SDK" class="headerlink" title="移动SDK"></a>移动SDK</h3><p>将目录移动到一个统一文件夹内部</p>
<p><img src="http://p09vx6soj.bkt.clouddn.com/QQ20180222-183750.jpg" alt="QQ20180222-183750"></p>
<p>修改<code>onPostProcessBuild</code>中的file路径为新SDK包的路径</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">var files</span> = Directory.GetFiles(unityEditorAssetPath + <span class="string">"/Plugins/FixShareSDK/ShareSDKiOSAutoPackage/Editor/SDKPorter"</span>, <span class="string">"*.projmods"</span>, SearchOption.AllDirectories);</span><br></pre></td></tr></table></figure>
<h3 id="更新Platforms"><a href="#更新Platforms" class="headerlink" title="更新Platforms"></a>更新Platforms</h3><p>建立空的GameObject,挂载<code>ShareSDK</code>和<code>Manage Platforms</code><br>点击保存按钮.</p>
<h2 id="检查Xcode项目"><a href="#检查Xcode项目" class="headerlink" title="检查Xcode项目"></a>检查Xcode项目</h2><p><img src="http://p09vx6soj.bkt.clouddn.com/QQ20180222-180840.jpg" alt="QQ20180222-180840"></p>
<p><img src="http://p09vx6soj.bkt.clouddn.com/QQ20180222-180942.jpg" alt="QQ20180222-180942"></p>
<p>检查导出的Xcode是否配置正确,及是否导出了多余的Lib包</p>
<h2 id="更改设置的原因"><a href="#更改设置的原因" class="headerlink" title="更改设置的原因"></a>更改设置的原因</h2><p>其默认的Unity包是依赖于Public变量改变来更新配置的. 但是Unity有时候会回滚操作(不明原因),之前设置的东西全部回滚为初始的配置了.</p>
<p>所以直接采用代码硬更改.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">隔壁老王</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">37</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">29</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">隔壁老王</span>

  
</div>









        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>访问人数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  






  
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine@1.1.4/dist/Valine.min.js"></script>
  <script type="text/javascript">
    new Valine({
        av: AV,
        el: '#vcomments' ,
        verify: false,
        notify: false,
        app_id: 'VgjGdP2hIi00FTVlhhkQYpOx-gzGzoHsz',
        app_key: 'f6jqD57DmTmu5lR3DdobF3py',
        placeholder: '说点啥?'
    });
  </script>



  





  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  

  

</body>
</html>
